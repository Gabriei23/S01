(defstruct ocorrencia
  nome
  ritual
  nivel-medo
  agentes-enviados)

(defun soma-medo-recursiva (lista)
  (if (null lista)
      0
      (+ (ocorrencia-nivel-medo (car lista))
         (soma-medo-recursiva (cdr lista)))))

(defun analise-final (lista)
  (let* ((total (soma-medo-recursiva lista))
         (quant (length lista))
         (media (/ total quant)))
    (mapcar (lambda (o)
              (ocorrencia-nome o))
            (remove-if-not
             (lambda (o)
               (and (> (ocorrencia-agentes-enviados o) 3)
                    (> (ocorrencia-nivel-medo o) media)))
             lista))))

(defparameter *ocorrencias*
  (list
   (make-ocorrencia :nome "Caso A" :ritual "Invocação" :nivel-medo 40 :agentes-enviados 5)
   (make-ocorrencia :nome "Caso B" :ritual "Maldição" :nivel-medo 80 :agentes-enviados 2)
   (make-ocorrencia :nome "Caso C" :ritual "Selo" :nivel-medo 60 :agentes-enviados 4)
   (make-ocorrencia :nome "Caso D" :ritual "Possessão" :nivel-medo 90 :agentes-enviados 6)
   (make-ocorrencia :nome "Caso E" :ritual "Ritual Sombrio" :nivel-medo 30 :agentes-enviados 4)))

(format t "~%Ocorrências Críticas:~%")
(dolist (n (analise-final *ocorrencias*))
  (format t "~A~%" n))
