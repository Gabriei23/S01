(defstruct item
  nome
  tipo
  preco
  forca-magica)

(defparameter *catalogo*
  (list
   (make-item :nome "Espada das Sombras" :tipo "Arma" :preco 200 :forca-magica 90)
   (make-item :nome "Punhal Curto" :tipo "Arma" :preco 80 :forca-magica 40)
   (make-item :nome "Pocao de Cura" :tipo "Pocao" :preco 30 :forca-magica 0)
   (make-item :nome "Orbe Ancestral" :tipo "Artefato" :preco 500 :forca-magica 120)))

(defun adiciona-imposto (preco)
  (* preco 1.15))

(defun bonus-maldicao (forca)
  (if (> forca 80)
      (* forca 1.5)
      forca))

(defun processa-venda (catalogo)
  (mapcar (lambda (i)
            (format nil "~A: Nova Força Mágica = ~A"
                    (item-nome i)
                    (bonus-maldicao (item-forca-magica i))))
          (mapcar (lambda (i)
                    (make-item
                     :nome (item-nome i)
                     :tipo (item-tipo i)
                     :preco (adiciona-imposto (item-preco i))
                     :forca-magica (item-forca-magica i)))
                  (remove-if-not (lambda (i)
                                   (string-equal (item-tipo i) "Arma"))
                                 catalogo))))

(dolist (linha (processa-venda *catalogo*))
  (format t "~A~%" linha))
